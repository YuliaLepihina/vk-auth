<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Авторизация через VK</title>
  <!-- Подключаем VK ID SDK напрямую в head -->
  <script type="text/javascript" src="/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=zIJxJpW7R7iOhOTHjLnYZ2u_rjDzGG2eaSzhgaCfaNgY23gW0tQxEtaRPaI_WPt11tkCTy5pJ-bE4CYrL-N-pD7bVksq8GGaty7thYxd8NbuKt_tpQ9h0BtRDWopiZrZQKy12kEOYCUs8iLYedXPmbaWf-cI1No6fZ21ZHlUHqGBBRvr-vFXbrEBNAvgJlr9dJaRbcvarB6FuBZPinFvZTPbCPhrk1_4RI-XzBvVx9wmQql_PZg1OU0AyjkuMlg34Z6yas7HaRCnyOhD7qsb3401mAjeknELSzyS1-vlQ8DOxeiPMYB8Am76xUItk7ivyca9nPBE3gAC7Jxi2sFS4m3_vxaxPg_I0dCukdu7ugUR37C2RGUF2eUlUQCoSgI0oTAI0VgvCVT8O0yHkrT0LJiYL7CmfS5jzSRyzfrHhosaEute30VfOhIxN3t2x8OyJxJ-cvtUatQDYrV7c-AZIFjSnPlzbu75m8rJ1EY7R6HIaNFeNrYBq5KZI0adrrJouUSEXfFnogP-0_-xezMVi9Qc-Eyg3OWFYeuZZvLLpLsZcPfCbrwa7nQ4Hcs_bFvUivoHUTrRJE37hg94ezYdNkuLKs3ROFDsORMOfcP17Idg9gv0x1qp1K-PSXYauikq5R_YOIFQIJ-yV4c8fOq8630Umy3koSwYCj_ZYXEIYqP149JxNaAE2DpivN1Giwnc3AIIcONgVdGuzrA8tJ8PcOIxhhhmbnqGMKi6E2sV4kv9Ce9XXQraUY9XWL9ibnklPCvBPF8abTgN2sA_Eyb8QllCnmXbKA1FdCxc9PUzPeQd_4QHlq6Yp7C-LH9_lfcJba84OHF3QSuU9Bc8j-2QIH4J9bxGjaidn0j6OQFUKZ7JDKVH1AhmezdnqnvBDJ4iNPihlcdFtjDOzIvocEKvQg" charset="UTF-8"></script><script src="https://unpkg.com/@vkid/sdk@2.5.2/dist-sdk/umd/index.js"></script>
</head>
<body>
  <h2>Авторизация через VK</h2>
  <div id="vk-auth-button"></div>

  <script>
    // Проверяем, что SDK загрузился
    document.addEventListener('DOMContentLoaded', function() {
      // Проверка доступности SDK
      if (typeof window.VKID === 'undefined') {
        console.error('VK ID SDK не загружен. Проверьте подключение к интернету и доступность CDN.');
        document.getElementById('vk-auth-button').innerHTML = 
          '<p style="color: red;">Ошибка: VK ID SDK не загружен. Пожалуйста, проверьте консоль.</p>';
        return;
      }

      try {
        // Используем глобальный объект VKID
        const vkid = window.VKID;
        console.log('VK ID SDK успешно загружен:', vkid);
        
        // Генерация code_verifier для PKCE
        const codeVerifier = generateRandomString(128);
        localStorage.setItem('code_verifier', codeVerifier);

        // Настройка SDK
        vkid.Config.set({
          app: 53635176, // Ваш ID приложения
          redirectUrl: 'https://vk.researcher123.space/auth.html',
          scope: 'video,offline'
        });

        // Отрисовка кнопки авторизации
        vkid.ButtonOneTap.render({
          container: '#vk-auth-button',
          callback: function(event) {
            console.log('Получено событие авторизации:', event);
            if (event.type === 'AUTH_SUCCESS') {
              if (event.data.code) {
                alert("Получен код авторизации: " + event.data.code);
                console.log("Код авторизации:", event.data.code);
              }
            } else if (event.type === 'AUTH_ERROR') {
              alert("Ошибка авторизации: " + event.data.error);
              console.error("Ошибка авторизации:", event.data.error);
            }
          }
        });
      } catch (error) {
        console.error('Ошибка при инициализации VK ID SDK:', error);
        document.getElementById('vk-auth-button').innerHTML = 
          '<p style="color: red;">Ошибка при инициализации VK ID SDK: ' + error.message + '</p>';
      }
    });

    // Функция для генерации случайной строки
    function generateRandomString(length) {
      const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';
      let text = '';
      for (let i = 0; i < length; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      return text;
    }
  </script>
</body>
</html>
